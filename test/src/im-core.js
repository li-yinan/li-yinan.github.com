/*! 2016 Baidu Inc. All Rights Reserved */
define("im-lib/lang/isObject",[],function(){return function(e){return"[object Object]"==Object.prototype.toString.call(e)}}),define("im-lib/lang/isArray",[],function(){return function(e){return"[object Array]"==Object.prototype.toString.call(e)}}),define("im-lib/lang/extend",[],function(){return function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}}),define("im-lib/lang/each",["require","./isArray"],function(require){return function(e,t,n){if(require("./isArray")(e)){for(var i=e.length,o=0;i>o;o++)if("function"==typeof t)t.call(n,e[o],o,e)}else for(var r in e)if(e.hasOwnProperty(r))t.call(n,r,e[r],e)}}),define("im-lib/lang",["require","./lang/isObject","./lang/isArray","./lang/extend","./lang/each"],function(require){var exports={};return exports.isObject=require("./lang/isObject"),exports.isArray=require("./lang/isArray"),exports.extend=require("./lang/extend"),exports.each=require("./lang/each"),exports}),define("im-lib/json",[],function(){function e(e){if(/["\\\x00-\x1f]/.test(e))e=e.replace(/["\\\x00-\x1f]/g,function(e){var t=r[e];if(t)return t;else return t=e.charCodeAt(),"\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16)});return'"'+e+'"'}function t(e){var t,n,i,r=["["],a=e.length;for(n=0;a>n;n++)switch(i=e[n],typeof i){case"undefined":case"function":case"unknown":break;default:if(t)r.push(",");r.push(o(i)),t=1}return r.push("]"),r.join("")}function n(e){return 10>e?"0"+e:e}function i(e){return'"'+e.getFullYear()+"-"+n(e.getMonth()+1)+"-"+n(e.getDate())+"T"+n(e.getHours())+":"+n(e.getMinutes())+":"+n(e.getSeconds())+'"'}function o(n){switch(typeof n){case"undefined":return"undefined";case"number":return isFinite(n)?String(n):"null";case"string":return e(n);case"boolean":return String(n);default:if(null===n)return"null";else if(n instanceof Array)return t(n);else if(n instanceof Date)return i(n);else{var r,a,c=["{"],s=o;for(var u in n)if(Object.prototype.hasOwnProperty.call(n,u))switch(a=n[u],typeof a){case"undefined":case"unknown":case"function":break;default:if(r)c.push(",");r=1,c.push(s(u)+":"+s(a))}return c.push("}"),c.join("")}}}var exports={};exports.parse=function(e){if(window.JSON&&JSON.parse)return JSON.parse(e);else return new Function("return ("+e+")")()},exports.stringify=function(e){if(window.JSON&&JSON.stringify)return JSON.stringify(e);else return o(e)};var r={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return exports}),define("im-lib/net",["require","./json","./lang"],function(require){function e(){if(window.ActiveXObject)try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}if(window.XMLHttpRequest)return new XMLHttpRequest;else return void 0}var t=require("./json"),n=require("./lang"),exports={};return exports.imgRequest=function(e){var t=document.createElement("img");t.src=e},exports.jsonp=function(e,t){function n(){return(new Date).getTime()}function i(){return Math.random().toString().substr(2)}function o(e){if(e){var t=e.parentNode;if(t&&11!==t.nodeType)t.removeChild(e)}}function r(e){var t="";if("string"==typeof e)t=e;else if("object"==typeof e)for(var i in e)t+="&"+i+"="+encodeURIComponent(e[i]);return t+="&_time="+n(),t=t.substr(1)}function a(e,a,c,s){var u,f=a.op,l=a.l,d=a.type;a=null,e=e+(-1===e.indexOf("?")?"?":"&")+r(a);var m=/callback=(\w+)/.exec(e);if(m&&m[1])u=m[1];else u="jsonp_bridge_"+n()+"_"+i(),e=e.replace("?","?"+t.key+"="+u+"&");var p=document.createElement("script");p.type="text/javascript",p.src=e,p.id="id_"+u,p.charset="utf-8";var g=(n(),0),h=null;if(window[u]=function(e){clearTimeout(h),window[u]=void 0;var t=document.getElementById("id_"+u);setTimeout(function(){o(t)},0),c(e)},"onerror"in p)p.onerror=function(){s&&s(),o(p)};var v=1e4;if(1===l)v+=2e4;h=setTimeout(function(){if(0===g)s&&s(),o(p)},v);var y=document.getElementsByTagName("head")[0];if(y)if(3===f||1===f||e.indexOf("chat/push")>-1&&2===+d)y.appendChild(p);else setTimeout(function(){y.appendChild(p)},0)}a(e,t,t.success,t.failure)},exports.request=function(t,n){var i=e();return i.open(n.method||"GET",t),i.onreadystatechange=function(){if(4==i.readyState)if(i.status>=200&&i.status<300||304==i.status){if(n.success)n.success(i.responseText)}else if(n.failure)n.failure()},n.contentType&&i.setRequestHeader("Content-Type",n.contentType),i.send(n.data),i},exports.post=function(e,t){t.method="post",t.contentType="application/x-www-form-urlencoded",t.data=exports.jsonToQuery(t.data),exports.request(e,t)},exports.jsonToQuery=function(e){var i=[];return n.each(e,function(e,o){if(n.isObject(o))o=t.stringify(o);i.push(e+"="+encodeURIComponent(o))}),i.join("&")},exports.upload=function(e,t,n,i,o){function r(){i(),l.onload=function(){},l.parentNode.removeChild(l)}function a(){o(),l.onerror=function(){},l.parentNode.removeChild(l)}if("/"==e.charAt(0))e=location.protocol+"//"+location.host+e;if("[object String]"===Object.prototype.toString.call(t)){var c=t;clouda.device.fs.post(c,e,{onsuccess:function(e){if(i)i(e)},onfail:function(){if(o)o()},uploadKey:n,param:{}})}else if(t.nodeName){var s=(t.getElementsByTagName("input")[0],"upload_iframe"+parseInt(1e4*Math.random(),10)),u='<iframe id="'+s+'" name="'+s+'" width="0" height="0" border="0" style="width: 0; height: 0; border: none;">',f=document.createElement("div");f.innerHTML=u;var l=f.getElementsByTagName("iframe")[0];if(document.body.appendChild(l),t.setAttribute("target",s),t.setAttribute("action",e),t.setAttribute("method","post"),t.setAttribute("enctype","multipart/form-data"),t.setAttribute("encoding","multipart/form-data"),l.attachEvent)l.attachEvent("onload",r),l.attachEvent("onerror",a);else l.onload=r,l.onerror=a;t.submit()}else if(window.FormData){var d=new FormData;d.append(n,t),exports.request(e,{success:i,failure:o,data:d,method:"post"})}},exports}),define("im-lib/util",[],function(){var exports={},e="0123456789ABCDEF";return exports.uuid=function(){for(var t=[],n=0;32>n;n++)t[n]=e.substr(Math.floor(16*Math.random()),1);t[12]="4",t[16]=e.substr(3&t[16]|8,1);var i=t.join("").toLowerCase();return i=i.toLowerCase(),i=i.replace(/^(\w{8})(\w{4})(\w{4})(\w{4})(\w{12})$/,"$1-$2-$3-$4-$5")},exports.decodeHTML=function(e){return e=e||"",e.replace("&lt;","<").replace("&gt;",">").replace("&amp;","&").replace("&quot;",'"').replace("&nbsp;"," ")},exports.encodeHTML=function(e){return e=e||"",e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/ /g,"&nbsp;")},exports.getText=function(e){var t="";if(3===e.nodeType||4===e.nodeType)t+=exports.decodeHTML(e.nodeValue);else if("IMG"===e.tagName)if(e.getAttribute("data-face-id"))return"["+(e.getAttribute("data-face-text")||"图片")+"]";else return"[图片]";else if(8!==e.nodeType)for(var n=0;n<e.childNodes.length;n++)t+=exports.getText(e.childNodes[n]);return t},exports}),define("im-lib/Emitter",[],function(){function e(){}var t=e.prototype;return t._getEvents=function(){if(!this._events)this._events={};return this._events},t._getMaxListeners=function(){if(isNaN(this.maxListeners))this.maxListeners=10;return this.maxListeners},t.on=function(e,t){var n=this._getEvents(),i=this._getMaxListeners();n[e]=n[e]||[];var o=n[e].length;if(o>=i&&0!==i)throw new RangeError("Warning: possible Emitter memory leak detected. "+o+" listeners added.");return n[e].push(t),this},t.once=function(e,t){function n(){i.off(e,n),t.apply(this,arguments)}var i=this;return n.listener=t,this.on(e,n),this},t.off=function(e,t){var n=this._getEvents();if(0===arguments.length)return this._events={},this;var i=n[e];if(!i)return this;if(1===arguments.length)return delete n[e],this;for(var o,r=0;r<i.length;r++)if(o=i[r],o===t||o.listener===t){i.splice(r,1);break}return this},t.emit=function(e){var t=this._getEvents(),n=t[e],i=Array.prototype.slice.call(arguments,1);if(n){n=n.slice(0);for(var o=0,r=n.length;r>o;o++)n[o].apply(this,i)}return this},t.listeners=function(e){var t=this._getEvents();return t[e]||[]},t.setMaxListeners=function(e){return this.maxListeners=e,this},e.mixin=function(t){for(var n in e.prototype)t[n]=e.prototype[n];return t},e}),define("im-lib/userData",[],function(){function e(e){return e.replace(i,"___")}function t(){if(!n)try{return n=document.createElement("input"),n.type="hidden",n.addBehavior("#default#userData"),document.body.appendChild(n),!0}catch(e){return!1}return!0}var exports={},n=null,i=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g"),o=365,r=location.hostname+"_bridge_im";return exports.setItem=function(i,a){if(t()){i=e(i);var c=new Date;c.setDate(c.getDate()+o),n.expires=c.toUTCString(),n.load(r),n.setAttribute(i,a),n.save(r)}},exports.getItem=function(i){if(!t())return"";else return i=e(i),n.load(r),n.getAttribute(i)},exports.removeItem=function(){if(t())key=e(key),n.load(r),n.removeAttribute(key),n.save(r)},exports.clear=function(){var e=new Date;e.setDate(e.getDate()-1),n.expires=e.toUTCString()},exports}),define("im-lib/localStorage",["require","./userData"],function(require){var exports={},e=window.localStorage||require("./userData");return exports.setItem=function(t,n){e.setItem(t,n)},exports.getItem=function(t){return e.getItem(t)},exports.removeItem=function(t){e.removeItem(t)},exports.clear=function(){e.clear()},exports}),define("im-lib/main",["require","./lang","./json","./net","./util","./Emitter","./localStorage"],function(require){return{lang:require("./lang"),json:require("./json"),net:require("./net"),util:require("./util"),Emitter:require("./Emitter"),localStorage:require("./localStorage")}}),define("im-lib",["im-lib/main"],function(e){return e}),define("bull/aop/JointPoint",["require"],function(require){function e(e,t,n,i,o,r){this.thisp=e,this.args=t,this.modName=n,this.funcName=i,this.func=o,this.returnValue=r}return e.prototype={constructor:e,getThis:function(){return this.thisp},getArgs:function(){return this.args},getModName:function(){return this.modName},getFuncName:function(){return this.funcName},getFunc:function(){return this.func},setReturnValue:function(e){this.returnValue=e},getReturnValue:function(){return this.returnValue}},e}),define("bull/aop/aopEmitter",["require","./main"],function(require){function e(e,n,i){var o=[],r=t;r=r[e]||{},r=r[n]||{},r=r[i]||[];for(var a=0;a<r.length;a++)o.push(r[a]);return o}var exports={},t={};return exports.on=function(e,n,i,o){var r=t;r[e]=r[e]||{},r=r[e],r[n]=r[n]||{},r=r[n],r[i]=r[i]||[],r=r[i],r.push({func:o.func,funcName:o.funcName,modName:o.modName})},exports.getBefore=function(t,n){var i=require("./main"),o=i.TypeEnum.BEFORE;return e(o,t,n)},exports.queryBefore=function(e,t){var n=exports.getBefore();if(console.log("method before "+e+" -> "+t+":"),!n.length)return void console.log("none");for(var i=0;i<n.length;i++)console.log(n[i].modName+" -> "+n[i].funcName);console.log("-----------------------------------")},exports.getAfter=function(t,n){var i=require("./main"),o=i.TypeEnum.AFTER;return e(o,t,n)},exports.queryAfter=function(e,t){var n=exports.getAfter();if(!n.length)return void console.log("none");console.log("method after "+e+" -> "+t+":");for(var i=0;i<n.length;i++)console.log(n[i].modName+" -> "+n[i].funcName);console.log("-----------------------------------")},exports.getRegisterAop=function(e){var n={},i=[],o=t[e];for(var r in o)if(o.hasOwnProperty(r)){var a=o[r];for(var c in a)if(a.hasOwnProperty(c)){if(!n[c])n[c]=!0,i.push({modName:r,funcName:c,from:a[c][0].modName})}}return i},exports.emit=function(t,n,i,o){for(var r=e(t,n,i),a=0;a<r.length;a++)r[a].func(o)},exports}),define("bull/microPromise/microPromise",["require"],function(require){function e(){for(var e=arguments.length,n=0,i=t(),o=[],r=0;e>r;r++){var a=arguments[r];!function(t){a.then(function(r){if(n++,o[t]=r,n===e)i.resolve.apply(i,o)},function(){i.reject()})}(r)}return i.promise()}var t=function(){function e(){for(var e=this,t=0;t<o.length;t++)!function(t){if(a&&a[0]&&a[0].then)a[0].then(function(){o[t].apply(e,arguments)});else setTimeout(function(){o[t].apply(e,a)},0)}(t)}function n(){for(var e=this,t=0;t<r.length;t++)!function(t){setTimeout(function(){r[t].apply(e,a)},0)}(t)}function i(e,n){var i=t();if(u===s.resolved){var f=this;setTimeout(function(){e.apply(f,a)},0)}else if(u===s.reject){var f=this;setTimeout(function(){n.call(f,c)},0)}else{if(e)o.push(function(){i.resolve(e.apply(f,arguments))});if(n)r.push(function(e){n(e),i.reject()})}return i.promise()}if(!this instanceof t)return new t;var o=[],r=[],a=[],c="",s={pendding:1,resolved:2,rejected:3},u=s.pendding,f={resolve:function(){var t=Array.prototype.slice.call(arguments,0);if(u===s.pendding)a=t,u=s.resolved,e.call(this)},reject:function(e){if(u===s.pendding)c=e,u=s.rejected,n.call(this)},then:i,promise:function(){return{then:i}}};return f};return{Deferred:t,when:e}}),define("bull/aop/main",["require","./JointPoint","./aopEmitter","../loader","../microPromise/microPromise"],function(require){function e(e,t,n){r.emit(a.BEFORE,e,t,n)}function t(e,t,n){r.emit(a.AFTER,e,t,n)}function n(e){return e=e||"",e.replace(/^\s|\s$/g,"")}function i(e){e=e||"";var t=e.split(","),i=n(t[0]||""),o=n(t[1]),r=n(t[2]);t=i.split(".");var a=t[0],c=t[1],s=t[2];return{packageName:a,modName:c,funcName:s,before:o,after:r}}var exports={},o=require("./JointPoint"),r=require("./aopEmitter"),a=exports.TypeEnum={BEFORE:"type1",AFTER:"type2"};return exports.createAopProxy=function(n,i,r){var a=require("../loader"),c=require("../microPromise/microPromise");return function(){var s=[],u=Array.prototype.slice.call(arguments,0),f=new o(this,u,n,i,r),l={jointPoint:f,microPromise:c};e(n,i,f);for(var d=a.getInjection(n)||{},m=d[i]||[],p=0;p<m.length;p++){var g=m[p];if(g in l)s.push(l[g]);else s.push(a.get(g))}s=s.concat(u);var h=r.apply(this,s);if(h&&h.then)h.then(function(e){f.setReturnValue(e),t(n,i,f)});else f.setReturnValue(h),t(n,i,f);return h}},exports.aspectRegister=function(e,t,n){var o=require("../loader");if(-1===e.indexOf("."))e=t+"."+e;for(var c=0;c<n.length;c++)!function(t){t.before&&r.on(a.BEFORE,t.packageName+"."+t.modName,t.funcName,{modName:e,funcName:t.before,func:function(n){var i=o.get(e)[t.before];if(!i)throw'module "'+e+"\" don't have method "+t.before;i.apply(n.getThis(),n.getArgs())}}),t.after&&r.on(a.AFTER,t.packageName+"."+t.modName,t.funcName,{modName:e,funcName:t.after,func:function(n){var i=o.get(e)[t.after];if(!i)throw'module "'+e+"\" don't have method "+t.after;i.apply(n.getThis(),n.getArgs())}})}(i(n[c]))},exports}),define("bull/loader",["require","./aop/main"],function(require){function e(t,n){var i;if("function"==typeof n){e(t,n.prototype);var o=s(t,r,n);return o.prototype=n.prototype,o}else{for(var r in n)if(n.hasOwnProperty(r)){if(i=n[r],"function"==typeof i)n[r]=s(t,r,i)}else;return n}}function t(e){e=e||[];for(var t=0;t<e.length;t++)exports.init(e[t])}function n(t,n){for(var i in t)if(t.hasOwnProperty(i)){var o=t[i];if(i=n+"."+i,r.hasOwnProperty(i)){if(o._belong&&i!==o._belong)throw'module conflict: module "'+i+'" is already register to "'+o._belong+'"'}else{if(o._belong)throw'module "'+i+'" already register to "'+o._belong+'"';o._belong=i,r[i]=e(i,o)}}else;}function i(e,t){e=e||[];for(var n=0;n<e.length;n++){var i=e[n];a[i.id]=a[i.id]||{};var o=a[i.id],r=i.method;for(var c in r)o[c]=r[c]}}function o(e,t){for(var n=0;n<e.length;n++){var i=e[n];u(i.id,t,i.pointCut)}}var exports={},r={},a={},c=require("./aop/main"),s=c.createAopProxy,u=c.aspectRegister;return exports.init=function(e){if(!e._initialized){e._initialized=!0;var r=e["package"];if(!r&&(e.resource||e.aspect))throw"package name not found";t(e.importConfig),e.resource&&n(e.resource,r),e.aspect&&o(e.aspect,r),e.injection&&i(e.injection,r)}},exports.getInjection=function(e){return a[e]},exports.getDeps=function(e){var t=a[e],n={};for(var i in t)if(t.hasOwnProperty(i))for(var o=t[i],r=0;r<o.length;r++)n[o[r]]=!0;delete n[e];var c=[];for(var i in n)if(i.indexOf(".")>-1)c.push(i);return c},exports.queryDep=function(e){var t=exports.getDeps(e);if(console.log("deps of "+e+" is:"),!t.length)console.log("none");for(var n=0;n<t.length;n++)console.log(t[n]);console.log("-----------------------------------")},exports.getModules=function(e){e=e||"";var t=[];for(var n in r)if(r.hasOwnProperty(n))if(e){if(n.indexOf(e)>-1)t.push(n)}else t.push(n);return t},exports.queryModule=function(e){var t=exports.getModules(e);if(e)console.log('modules contains "'+e+'":');else console.log("all modules:");for(var n=0;n<t.length;n++)console.log(t[n]);console.log("-----------------------------------")},exports.queryInvoke=function(e){var t=[],n={};for(var i in a)if(a.hasOwnProperty(i)){var o=a[i];for(var r in o)if(o.hasOwnProperty(r))for(var c=o[r],s=0;s<c.length;s++){var u=c[s];if(u===e){var f=i+u;if(f in n)continue;else n[f]=!0;t.push({modName:i,funcName:r})}}}if(t.length){console.log("module "+e+" used by these method:");for(var s=0;s<t.length;s++)console.log(t[s].modName+" -> "+r)}else console.log("module"+e+" used nowhere");console.log("-----------------------------------")},exports.checkDep=function(){var e,t=0;console.log("checking deps:");for(var n in r)if(r.hasOwnProperty(n)){e=exports.getDeps(n);for(var i=0;i<e.length;i++)if(!exports.has(e[i]))if(e[i].indexOf(".")>-1)t++,console.log(e[i]+" is required by "+n+" but now missing")}if(!t)console.log("all dependencies is ready");console.log("-----------------------------------")},exports.has=function(e){return e in r},exports.get=function(e){if(e in r)return r[e];else throw'module "'+e+'" not found'},exports}),define("bull/main",["require","./loader","./aop/aopEmitter"],function(require){function e(){var e=document.createElement("div"),t=e.style;t.position="fixed",t.right="20px",t.top="20px",t.border="solid 1px black",t.backgroundColor="#eee",e.innerHTML="点此查看<br/>模块关系";var n=!1;e.onclick=function(){if(!n)n=!0,require(["bull/debug"],function(e){n=!1,e.entry()})},document.body.insertBefore(e,document.body.firstChild)}function t(){var t=location.hash;if(t.indexOf("bullDebug")>-1)e()}var exports={},n=require("./loader"),i=require("./aop/aopEmitter");return exports.get=n.get,exports.queryBefore=i.queryBefore,exports.queryAfter=i.queryAfter,exports.queryInvoke=n.queryInvoke,exports.queryDep=n.queryDep,exports.checkDep=n.checkDep,exports.queryModule=n.queryModule,exports.init=function(e){t(),n.init(e)},exports}),define("bull",["bull/main"],function(e){return e}),define("im-core/plugin/fileTransfer",["require","../main"],function(require){var e=1,exports={};exports.encoder={};var t=exports.encoder;t.fileAccept=function(t,n){n({mtype:e,content:{type:"file",data:{bcsName:t.bcsName,name:t.name,size:t.size,type:"accept"}}})},t.fileVUpload=function(t,n){n({mtype:e,content:{type:"file",msgInfo:t.msgInfo,data:{status:t.status,bcsName:t.bcsName,name:t.name,size:t.size,type:"vUpload"}}})},t.fileVDownLoad=function(t,n){n({mtype:e,content:{type:"file",data:{status:t.status,bcsName:t.bcsName,name:t.name,type:"vDownLoad"}}})},t.fileVCancelSend=function(t,n){n({mtype:e,content:{type:"file",data:{bcsName:t.bcsName,name:t.name,type:"vCancelSend"}}})},exports.decoder={};var n=require("../main");return exports.decoder.fileTransfer=function(e,t){e=e||{};var i=e.content||{},o=i.data||{},r=i.msgInfo||{},a={bcsName:o.bcsName,name:o.name},c="";switch(o.type){case"accept":c="fileAccept",a.status=o.status;break;case"sDownLoad":c="fileSDownLoad",a.status=o.status;break;case"sUpLoad":c="fileSUpload",a.size=o.size;break;case"vCancelSend":c="vCancelSend";break;case"vDownLoad":c="vDownLoad",a.status=o.status;break;case"vUpload":c="vUpload"}n.emit(c,a,r)},exports}),define("im-core/const",[],function(){var exports={};return exports.PLATFORM_PC=0,exports.PLATFORM_MOBILE=1,exports.SERVER_TIEXIN=1,exports.SERVER_DUZHAN=2,exports.SERVER_QIAO=3,exports.AUTH_TYPE_LOCAL=0,exports.AUTH_TYPE_QIAO=4,exports.AUTH_TYPE_DUZHAN=5,exports.CHAT_TYPE_USER=0,exports.CHAT_TYPE_GROUP=1,exports.CHAT_TYPE_IR=4,exports.PUSH_TYPE_BYE=2,exports.PUSH_TYPE_CHAT=3,exports.PUSH_TYPE_OFFLINE=4,exports.PUSH_TYPE_FETCH_HISTORY=5,exports.PUSH_TYPE_PRE_SEND=6,exports.PUSH_TYPE_FETCH_SESSION_MESSAGE=7,exports.CHART_START_TYPE="vsturl:u",exports}),define("im-core/config",["require","./const"],function(require){var e=require("./const");return{bid:"",siteid:"",eid:"",crossDomain:!1,platform:e.PLATFORM_PC,server:e.SERVER_QIAO,authType:e.AUTH_TYPE_QIAO,authToken:"bridge",urlRoot:location.protocol+"//p.qiao.baidu.com/cps/",sid:"-100",tid:"-1",fromType:1,ttype:1,reasons:["vstreq:u","vstsys:u","vstwtr:u","vsturl:u","vstwtr:f","vstreq:f","vstsys:f"]}}),define("im-core/plugin/unknownMsg",["require","im-lib","../config","im-core"],function(require){function e(e,t){t({content:{content:{data:e.content,msgInfo:e.msgInfo||{},type:e.msgType||""},type:a},mtype:r})}function t(e,t){e=e||{};var a=e.content||{},c=a.content;if(a.mtype===o||a.mtype===r)try{c=n.json.parse(a.content),c.msgInfo=c.msgInfo||{};var u=e.adata&&n.json.parse(e.adata)||{};c.nickname=u.nickname||s}catch(f){c=a.content}c.role=e.from===i.bid?0:1,require("im-core").emit("unknownMsg",c)}var exports={},n=require("im-lib"),i=require("../config"),o=1,r=4,a="unable message",c="unable message",s="对方";return exports.encoder={},exports.encoder[a]=e,exports.decoder={},exports.decoder[c]=t,exports}),define("im-core/net",["require","im-lib"],function(require){function e(){}var exports={},t=require("im-lib").Emitter;t.mixin(exports);var n="POST";return exports.jsonToQuery=function(e,t,n){var i=[];return t.each(n,function(n,o){if(t.isObject(o))o=e.stringify(o);i.push(n+"="+encodeURIComponent(o))}),i.join("&")},exports.request=function(t,i,o,r,a,c){var s=t.urlRoot+a;c=c||{};var u=c.failure||e,f=c.success||e;c.success=function(e){try{if(-1!==Object.prototype.toString.call(e).indexOf("String"))e=r.parse(e)}catch(t){return void u()}if(i.set("sn",e.n_sn),!e.status||2===e.status)exports.emit("response",a,e.body||e),f(e.body||e);else exports.emit("auth invalid"),u(e)};var l=c.data||{};if(exports.emit("request",a,l),l.v=t.bid,l.s=t.siteid,l.e=t.eid,l.dev=t.platform,l.auth=i.get(),c.data=null,t.crossDomain){if(s+=s.indexOf("?")>=0?"&":"?",s+=exports.jsonToQuery(l),c.type=l.type,c.key="cb",c.op=l.op,c.l=l.l,2===l.type&&"chat/push"===a&&!f&&!u||3===l.op&&"site/auth"===a&&!f&&!u||1===l.op&&"site/st"===a&&!f&&!u){var d=document.createElement("img");return void(d.src=s)}o.jsonp(s,c)}else{if(c.method=c.method||"POST",c.method===n)c.data=r.stringify(l),s=s+"?v="+l.v;else s+=s.indexOf("?")>=0?"&":"?",s+=exports.jsonToQuery(l),s+="&v="+l.v;if(c.setCookie)s=s+"&s="+l.s,s=s+"&t="+c.setCookie;o.request(s,c)}},exports.auth=function(e,t,n,i){var o;if(0===e.visitType)o=t?0:1;else o=t?2:3;var r={success:n,failure:i,data:{op:o,dev:e.platform,ser:e.server}};if(!t)r.method="GET";exports.request("site/auth",r)},exports.poll=function(e,t,n){var i={success:t,failure:n,data:{l:e?1:0}};exports.request("site/poll",i)},exports.site=function(e,t,n,i){var o={success:n,failure:i,data:{op:e?0:1,s_info:t,url:location.href}};if(!e)o.method="GET";exports.request("site/st",o)},exports.chat=function(e,t,n){var i={success:t,failure:n,data:e};exports.request("chat/st",i)},exports.pick=function(e,t,n){var i={success:t,failure:n,data:{l:1,sid:e||""}};exports.request("chat/poll",i)},exports.push=function(e,t,n){var i={success:t,failure:n,data:e||{}};if(2===e.type)i.method="GET";exports.request("chat/push",i)},exports.node=function(e,t,n){var i={success:t,failure:n,data:e||{}};exports.request("bookmanage/saveBook.action",i)},exports.upload=function(e,t,n,i,o,r){t.upload(e.urlRoot+n,i,"file",o,r)},exports.getUploadUrl=function(e,t,n,i){return i=i||t.uuid(),e.urlRoot+"wupload/"+i+"/"+n.get("sid")},exports.getDownloadUrl=function(e,t,n,i,o){return i=i||t.uuid(),o=o||i,e.urlRoot+"wdownload/"+i+"/"+n.get("sid")+"/"+o},exports.log=function(e,t,n){var i=t+"/eye/log/js/stat.gif?";i+=exports.jsonToQuery(n),e.imgRequest(i)},exports}),define("im-core/chat",["require","im-lib","./config","./net"],function(require){function e(e){if(!e&&h.connected)exports.emit("disconnect");h.stopPick=!0,h.connected=!1}function t(){if(!h.connected)if(h.csonline)if(!h.csonline||h.online)h.connected=!0,exports.emit("connected",{sid:h.sid}),m.each(h.msgPool,function(e){exports.emit("message",e)}),h.msgPool=[]}function n(t,n){var i={type:t};if(n)i.data=n;exports.emit("error",i),e()}function i(e,t){if(!e.pickType)h.sid=e.sid,h.to=e.uid,h.authType=e.authtype,h.csonline=!0,h.ttype=e.ttype;if(t)p.sinfo=e.sinfo&&l.json.parse(e.sinfo)||{}}function o(){k={ifIR:!1,count:0,id:null}}function r(){t()}function a(e){exports.emit(e===!0?"fetchhistorysuccess":"fetchhistoryfail"),exports.emit("fetchhistoryfinish"),t()}function c(e){var t;if(e&&1===e.status&&"auth invalid"===e.errinfo)n("offline"),t=!0;return t}function s(e){if(P=0,I)I=!1,exports.emit("reconnect");if(exports.isConnected()){var t=h.options.siteid;if(t)l.localStorage.setItem("ACTIVE_"+t,+new Date)}m.each(e,function(e){var t=e.type,n=_[t];if(n)n(e.msg)}),f()}function u(e){if(P++,P>q&&!I)I=!0,exports.emit("offline");if(!c(e))setTimeout(function(){f()},3e3)}function f(){if(!h.stopPick)setTimeout(function(){g.pick(h.sid,s,u)},0)}var l=require("im-lib"),d=l.Emitter,m=l.lang,p=require("./config"),g=require("./net"),h={connected:!1,stopPick:!1,csonline:!1,msgPool:[]},v={INVITE:18,ACCEPT:20,BYE:28},y={OVER:4,TAKE_OVER:3,TRANSFER:6,RECEIVE:2},b="blocked",T="auto",E={SUCCESS:0,FAILURE:1},w={QUEUEING:2,TALKING:4},R=10,k={ifIR:!1,count:1,id:null},N={CSR:0,GROUP:1,IR:4},A={READY:0,BUSY:1,LEAVE:2,UNLOGIN:3},S={TRANSFER:0,CONVERSATION:1},exports={};d.mixin(exports),g.on("auth invalid",function(){h.stopPick=!0});var _={};_[100]=function(e){if(e.op===v.ACCEPT)if(e.st===E.SUCCESS)h.sid=e.sid,h.to=e.uid,h.authType=e.authtype,h.csonline=!0,h.online=!0,p.sinfo=e.sinfo&&l.json.parse(e.sinfo)||{},exports.fetchHistory();else exports.bye();if(e.op===v.BYE)if(e.st===E.SUCCESS){var n=h.options||{};if("talk to other"===e.reason)h.stopPick=!1,n.invited=0,n.tid=p.tid,n.ttype=1,n.sid="",n.from=4,exports.connect(n.ttype,n,!1)}else exports.emit("invitefail");if(e.op===v.INVITE){if("queue"===e.reason)return;if(e.ttype===N.IR)k.ifIR=!0,k.id=e.uid,exports.emit("currentIR");if("re_invite"===e.reason&&p.status===w.QUEUEING)return void exports.emit("queueing");if("re_invite"===e.reason)return p.sinfo=e.sinfo&&l.json.parse(e.sinfo)||{},h.sid=e.sid,h.to=e.uid,h.authType=e.authtype,h.tid=p.tid||"",h.ttype=e.ttype,h.csonline=!0,h.online=!0,void(p.syncSessionHistory?exports.fetchSessionMessage():t());if(e.st===E.SUCCESS)h.sid=e.sid,h.to=e.uid,h.authType=e.authtype,h.csonline=!0,h.ttype=e.ttype,p.sinfo=e.sinfo&&l.json.parse(e.sinfo)||{};else exports.emit("csoffline");exports.fetchHistory()}},_[101]=function(t){if(t.opr===y.OVER)if(t.reason&&-1!==t.reason.indexOf(b))exports.emit("visitorblock",t),e();else if(t.reason&&-1!==t.reason.indexOf(T))exports.emit("autoendtalk",t),e();else n("forceover");else if(t.opr===y.TAKE_OVER)if(i(t,!0),k.ifIR)o(),exports.emit("fininshIR",{type:"invite"});else exports.emit("updateNewCSR",p.sinfo);else if(t.opr===y.TRANSFER)if(i(t,!0),k.ifIR)o(),exports.emit("fininshIR",{type:"online"});else exports.emit("updateNewCSR",p.sinfo);else if(t.opr===y.RECEIVE){var r=t.detail||{};if(r.join_action===S.TRANSFER){var a=!1,c=t.adata&&l.json.parse(t.adata)||{},s=c.transfer||{},u=t.sinfo&&l.json.parse(t.sinfo)||{};if(s.status)a=!0,exports.emit("visitorTransfer",{nickname:u.nickname||""});i(t,a)}}},_[103]=function(e){if(h.connected){if(exports.emit("message",e),k.ifIR&&e.from===k.id&&k.count)if(++k.count>=5)exports.emit("showMsgRemind",k.count),k.count=0}else h.msgPool.push(e)},_[104]=function(e){if(p.status=e.status,e.status===w.QUEUEING)h.sid=e.sid,h.queueing=!0,exports.emit("queueing");if(e.status===w.TALKING)if(h.queueing=!1,h.sid=e.sid,h.online=!0,t(),k.ifIR)if(""!==e.reason)exports.emit("transferError",e)},_[105]=function(e){if(e.type){var t=e.detail||[];if(t.reverse(),m.each(t,function(e){exports.emit("message",e)}),t.length>=R)exports.fetchHistory();else a(!0)}},_[106]=function(e){h.sid=e.sid,h.to=e.uid,h.authType=e.authtype,h.csonline=!0,p.sinfo=e.sinfo&&l.json.parse(e.sinfo)||{},exports.fetchHistory()},_[107]=function(e){if(!e.webmsg)return void r();var t=l.json.parse(e.webmsg);m.each(t.body,function(e){var t=e.msg;t.time=parseInt(+t.time/1e3,10);var n=e.msg.content;if(l.lang.isArray(n))m.each(n,function(e){var n=e.pickType;if(n){var i=_[n];if(i)i(e)}else t.content=e.content||e,t.mtype=e.mtype||0,exports.emit("message",t)})}),r()},_[108]=function(e){if(k.ifIR&&e.status===A.READY)exports.emit("csonline",e)},exports.fetchHistory=function(e){var t={sid:h.sid,tid:h.tid,type:e.PUSH_TYPE_FETCH_HISTORY,tid_authtype:p.authType,param:{type:1,from:h.to,max_count:R,from_authtype:h.authType}};g.push(t,null,a)},exports.fetchSessionMessage=function(e){var t=h.tid||"",n=t,i="";if(t.indexOf(":")){var o=t.split(":");n=o[0],i=o[1]||""}var r=l.json.stringify({tag:1,type:2,userId:n-0,subId:i-0,bid:p.bid}),a={sid:h.sid,tid:h.tid,type:e.PUSH_TYPE_FETCH_SESSION_MESSAGE,tid_authtype:p.authType,param:{webmsg:r}};g.push(a)},exports.bye=function(e){var t={sid:h.options.sid,tid:h.tid,type:e.PUSH_TYPE_BYE,tid_authtype:p.authType,param:{reason:"bye for invite error"}};g.push(t)};var P=0,I=!1,q=3;return exports.pick=f,exports.connect=function(e,t,i,o){i=i||{},h.tid=i.tid||"",h.options=i;var r={op:0,sid:i.sid||"",tid:h.tid,tid_authtype:p.authType,invited:i.invited-0?1:0,rtype:i.route||0,ttype:t,inviterefer:document.referrer,reason:p.reasons[i.from]||e.CHART_START_TYPE};g.chat(r,function(){if(o!==!1)h.stopPick=!1,f()},function(){n("connect")})},exports.talking=function(e,n){if(n=n||{},e=e||{},p.sinfo=e.sinfo&&l.json.parse(e.sinfo)||{},h.sid=e.sid,h.to=n.tid,h.authType=e.authtype,h.csonline=!0,h.online=!0,h.tid=e.tid||"",h.options=n,h.stopPick=!1,p.syncSessionHistory)exports.fetchSessionMessage();else t();f()},exports.queue=function(e,t){t=t||{},e=e||{},p.sinfo=e.sinfo&&l.json.parse(e.sinfo)||{},h.sid=e.sid,h.to=e.uid,h.authType=e.authtype,h.csonline=!0,h.tid=e.tid||"",h.options=t,h.stopPick=!1,exports.emit("queueing"),f()},exports.preSend=function(e,t){if(t.content){t.mtype=0,t.to=h.to,t.time=(new Date).getTime(),t.rtype=h.ttype;var n={sid:h.sid||"",tid:h.to,type:e.PUSH_TYPE_PRE_SEND,tid_authtype:h.authType,param:t};g.push(n)}},exports.send=function(e,t,n,i){t.from=p.bid,t.to=h.to,t.time=(new Date).getTime(),t.rtype=h.ttype;var o={sid:h.sid||"",tid:h.to,type:h.csonline?e.PUSH_TYPE_CHAT:e.PUSH_TYPE_OFFLINE,tid_authtype:h.authType,param:t};if(void 0!==t.adata)o.adata=t.adata,delete t.adata;g.push(o,n,function(e){if(c(e),i)i()})},exports.disconnect=function(t,n,i){t=t||{};var o=void 0===t.tid_authtype?h.authType:t.tid_authtype;o=o||4,g.push({type:2,sid:t.sid||h.sid,tid:t.tid||h.to||-1,reason:t.reason||"",tid_authtype:o},n,i),e(!0)},exports.isConnected=function(){return h.connected},exports.get=function(e){return h[e]},exports.setStopPick=function(e){h.stopPick=e},exports}),define("im-core/plugin/img",["require","im-lib","../chat","../net","im-core/chat","../main"],function(require){function e(e){return e=e.split(l?"\\":"/"),e.pop()}function t(e){return"wupload/"+e+"/"+a.get("sid")}function n(e,t){var n=require("im-core/chat");return t=t||"a.jpg","wdownload/"+e+"/"+n.get("sid")+"/"+t}function i(n,i){var o=(e(n.path),n.bcsName),r=t(o);s[r]={msg:n,done:i};var a='<img id="'+o+'" data-uploaded="0" data-bcsName="'+o+'"/>',l={mtype:0,content:a};i(l);var d={mtype:f,content:{type:u,bcsName:o}},m=require("../main");c.upload(r,n.form||n.path,function(){d.content.status=0,i(d),m.emit("imgsendsuccess",{bcsName:o,id:n.mid})},function(){d.content.status=1,i(d),m.emit("imgsendfail",{bcsName:o,id:n.id})})}function o(e,t){var i=e.content,o=i.bcsName,r=n(o,"img");t({type:u,bcsName:o,bcsUrl:r,status:i.status})}var r=require("im-lib").Emitter,a=require("../chat"),c=require("../net"),s={},u="img",f=1,l=/ window nt/i.test(navigator.userAgent),exports={};return r.mixin(exports),exports.encoder={},exports.encoder[u]=i,exports.decoder={},exports.decoder[u]=o,exports}),define("im-core/plugin/shake",["require","../main"],function(require){
function e(e,t){t({mtype:i,content:{type:n}})}function t(e,t){var n=require("../main");n.emit("shake"),t()}var exports={},n="shake",i=4;return exports.encoder={},exports.encoder[n]=e,exports.decoder={},exports.decoder[n]=t,exports}),define("im-core/plugin/text",["require","../chat","../config","im-core/chat"],function(require){function e(e,t){var n=document.createElement("div");n.innerHTML=e.text||"";for(var i=n.getElementsByTagName("img"),o=i.length;o;o--){var r=i[o-1];if(r.getAttribute("data-bcsName")){var c=document.createElement("img");c.setAttribute("data-bcsName",r.getAttribute("data-bcsName")),c.setAttribute("data-uploaded",r.getAttribute("data-uploaded")),c.id=r.id,r.id="";var s=r.parentNode;s.insertBefore(c,r),s.removeChild(r)}}t({mtype:a,content:n.innerHTML.replace(/\r|\n/gi,"")||""})}function t(e,t){var n=require("im-core/chat");return t=t||"a.jpg",o.urlRoot=o.urlRoot||"",o.urlRoot+"wdownload/"+e+"/"+n.get("sid")+"/"+t}function n(e){var n=document.createElement("div");n.innerHTML=e;for(var i=n.getElementsByTagName("img"),o=0;o<i.length;o++){var r=i[o],a=r.getAttribute("data-bcsName"),c=r.getAttribute("data-bcsUrl");if(a&&!c)c=t(a,a),r.setAttribute("data-bcsUrl",c)}return n.innerHTML}function i(e,t){var i=(require("../chat"),n(e.content)),a=e.from===o.bid?0:1;t({type:r,role:a,time:1e3*e.time,text:i||""})}var o=(require("../chat"),require("../config")),r="text",a=0,exports={};return exports.encoder={},exports.encoder[r]=e,exports.decoder={},exports.decoder[a]=i,exports}),define("im-core/plugin/transfer",[],function(){function e(e,t){t({mtype:i,content:{type:n}})}function t(e,t){t()}var exports={},n="transfer",i=4;return exports.encoder={},exports.encoder[n]=e,exports.decoder={},exports.decoder[i]=t,exports}),define("im-core/plugin/uploaded",[],function(){function e(e,t){t({mtype:i,content:{type:n,bcsName:e.bcsName,status:0}})}function t(e,t){t()}var exports={},n="img",i=1;return exports.encoder={},exports.encoder.uploaded=e,exports.decoder={},exports.decoder.uploaded=t,exports}),define("im-core/plugin/voice",["require","../config"],function(require){function e(e,t){t({mtype:o,content:e})}function t(e,t){var o=e.content,a=e.from===n.bid?0:1;t({type:i,role:a,text:r+o.text,bcsName:o.bcsName,fetchURL:c.replace(/#{bcsName}/g,o.bcsName),duration:o.duration,token:o.token})}var n=require("../config"),i="voice",o=2,r="语音转译：",a=location.protocol,c=a+'//p.qiao.baidu.com/cps/audio/getAudio?reqParam={"audioName": "#{bcsName}"}',exports={};return exports.encoder={},exports.encoder[i]=e,exports.decoder={},exports.decoder[i]=t,exports}),define("im-core/plugin/location",["require","../config"],function(require){function e(e,t){t({mtype:o,content:e})}function t(e,t){var o=e.from===n.bid?0:1;e.content.type=i,e.content.role=o,e.content.text=r,t(e.content)}var n=require("../config"),i="location",o=4,r="[地理位置]",exports={};return exports.encoder={},exports.encoder[i]=e,exports.decoder={},exports.decoder[i]=t,exports}),define("im-core/plugin/config",["require","./fileTransfer","./unknownMsg","./img","./shake","./text","./transfer","./uploaded","./voice","./location"],function(require){return{"package":"coreplugin",resource:{fileTransfer:require("./fileTransfer"),unknownMsg:require("./unknownMsg"),img:require("./img"),shake:require("./shake"),text:require("./text"),transfer:require("./transfer"),uploaded:require("./uploaded"),voice:require("./voice"),location:require("./location")}}}),define("im-lib/config",["require","./lang","./json","./net","./util","./Emitter","./localStorage"],function(require){return{"package":"imLib",resource:{lang:require("./lang"),json:require("./json"),net:require("./net"),util:require("./util"),Emitter:require("./Emitter"),localStorage:require("./localStorage")}}}),define("im-core/auth",["require"],function(require){var e={},exports={};return exports.get=function(t,n){var i={anonym:t.anonym,key:e.key||"",sn:e.sn||"",id:t.bid||"",from:t.authType,token:t.authToken||""};if(n)return i[n];else return i},exports.set=function(t,n){e[t]=n},exports}),define("im-core/message",["require"],function(require){function e(){}function t(t,n){return t=t||e,n=n||e,function(e){if(e===!1)n();else if(e)t(e)}}var n=1,i=2,o=4,r={},a={},exports={};return exports.encode=function(e,n,i){var o=r[e.type];if(!o)throw e.type+" message not supported";o(e,t(n,i))},exports.decode=function(e,r,c){var s=e.mtype;if(s===n||s===o||s===i)if(e.content&&e.content.type)if(s=e.content.type,"file"===s)s="fileTransfer";var u=a[s];if(u)u(e,t(r,c));else if(c)c()},exports.addEncoder=function(e,t){e.each(t,function(e,t){r[e]=t})},exports.addDecoder=function(e,t){e.each(t,function(e,t){a[e]=t})},exports}),define("im-core/site",["require"],function(require){var exports={};return exports.init=function(e,t,n){t.extend(e,n||{}),e.anonym=e.bid?0:1},exports.enter=function(e,t,n){if(t=t||function(){},n=n||function(){},e.isLogin())t();else e.login(t,n)},exports.leave=function(e){if(e.isLogin())e.logout()},exports}),define("im-core/user",["require","./net"],function(require){function e(){clearTimeout(n),n=null,i=!1}var exports={},t=require("./net");t.on("auth invalid",function(){e()});var n,i,o={INVITE:1,AUTH:2},r="blocked";exports.heartBeat=function(e){function t(){n=setTimeout(exports.heartBeat,15e3)}e.poll(!1,t,t)};var a={};return exports.refresh=function(e,t){if(i)t.poll(!0,function(t){e.each(t,function(e){var t=a[e.type+""];if(t)t(e.msg)}),exports.refresh()},function(){setTimeout(exports.refresh,3e3)})},exports.pickHandler1=function(e,t,n,i){if("invite"===i.reason)n.sid=i.sid,n.tid=i.uid,n.fromType=2,n.ttype=0,e.emit("initiative",i);else if("chat"===i.reason)n.sid=i.sid,n.tid=i.uid,n.ttype=i.ttype,n.invited=1,n.sinfo=i.sinfo&&t.parse(i.sinfo)||{},e.emit("forcetalk",i)},exports.pickHandler104=function(e,t,n){t.status=n.status,e.emit("watchStatus",n)},a[1]=function(e){exports.pickHandler1(e)},a[104]=function(e){exports.pickHandler104(e)},exports.getInfo=function(e){function t(){var e=(new Date).getTimezoneOffset(),t=parseInt(e/60,10),n=e%60,i="-";if(0>t||0>n)if(i="+",t=-t,0>n)n=-n;return t+="",n+="","UTC"+i+t+":"+n}var n=window.navigator,i=window.screen,o={lang:n.language||n.systemLanguage,cbit:i.colorDepth,rsl:i.width+"*"+i.height,tz:t(),referrer:encodeURIComponent(document.referrer)};return o},exports.enter=function(e,t,n){e.site(!0,exports.getInfo(),function(){exports.getEnterResult(t,n)},n)},exports.checkEnterResult=function(e,t,n,o,r){var a=!1;return e.each(n,function(n){if(100===n.type){var c=n.msg||{};if(3===c.status&&0===t.visitType){var s=t.tid||"",u=t.sid||"";e.extend(t,c),t.tid=s,t.sid=u}else e.extend(t,c);if(a=!0,i=!0,0===t.visitType)exports.heartBeat();else exports.refresh();o(n.msg)}else r()}),a},exports.checkAuthResult=function(e,t,n,i,a,c){var s=!1;return e.each(n,function(e){if(e.type===o.AUTH){if(s=!0,e=e.msg||{},e.reason&&-1!==e.reason.indexOf(r))return void(c&&c());if(e.valid)t.bid=e.v,exports.enter(i,a);else a()}}),s},exports.getEnterResult=function(e,t,n){e.poll(!0,function(e){if(!exports.checkEnterResult(e,t,n))exports.getEnterResult(t,n)},n)},exports.getAuthResult=function(e,t,n,i){e.poll(!0,function(e){if(!exports.checkAuthResult(e,t,n,i))exports.getAuthResult(t,n,i)},n)},exports.isLogin=function(){return!!n||i},exports.login=function(e,t,n,i,o,r){if(!exports.isLogin())e.auth(!0,function(e){t.set("key",e.key),n.bid=e.v,exports.getAuthResult(i,o,r)},o);else i()},exports.logout=function(t){e(),t.site(!1),t.auth(!1)},exports}),define("im-core/log",["require"],function(require){var exports={};return exports.send=function(){},exports}),define("im-core/bullConfig",["require","./plugin/config","im-lib/config","./main","./auth","./config","./const","./chat","./message","./site","./user","./net","./log"],function(require){return{"package":"core",importConfig:[require("./plugin/config"),require("im-lib/config")],resource:{main:require("./main"),auth:require("./auth"),config:require("./config"),"const":require("./const"),chat:require("./chat"),message:require("./message"),site:require("./site"),user:require("./user"),net:require("./net"),log:require("./log")},injection:[{id:"core.main",method:{initCore:["core.chat","core.config","imLib.lang","core.const"],connect:["core.chat","core.config","core.user"],auth:["core.user"],send:["core.chat","core.message"],addPlugin:["coreplugin.fileTransfer","coreplugin.img","coreplugin.unknownMsg","coreplugin.shake","coreplugin.text","coreplugin.transfer","coreplugin.uploaded","coreplugin.voice","coreplugin.location"],preSend:["core.chat","core.message"],plugin:["core.message"],disconnect:["core.chat","core.user"],messageHandler:["core.config"],get:["core.chat"],bindEvent:["core.main","communicate.handler"]}},{id:"core.auth",method:{get:["core.config"]}},{id:"core.chat",method:{fetchHistory:["core.const"],connect:["core.const"],fetchSessionMessage:["core.const"],bye:["core.const"],preSend:["core.const"],send:["core.const"]}},{id:"core.message",method:{addEncoder:["imLib.lang"],addDecoder:["imLib.lang"]}},{id:"core.net",method:{jsonToQuery:["imLib.json","imLib.lang"],getUploadUrl:["core.config","imLib.util","core.main"],getDownloadUrl:["core.config","imLib.util","core.main"],request:["core.config","core.auth","imLib.net","imLib.json"],auth:["core.config"],upload:["core.config","imLib.net"],initLog:["core.config","data.config"],log:["imLib.net"]}},{id:"core.site",method:{init:["core.config","imLib.lang"],enter:["core.user"],leave:["core.user"]}},{id:"core.user",method:{refresh:["imLib.lang","core.net"],getInfo:["imLib.lang"],enter:["core.net"],checkEnterResult:["imLib.lang","core.config"],getAuthResult:["core.net"],login:["core.net","core.auth","core.config"],logout:["core.net"],getEnterResult:["core.net"],pickHandler1:["core.main","imLib.json","core.config"],pickHandler104:["core.main","core.config"],heartBeat:["core.net"],checkAuthResult:["imLib.lang","core.config"]}}],aspect:[{id:"core.message",pointCut:["core.main.decode, , decode"]},{id:"core.net",pointCut:["core.log.send, ,log"]}]}}),define("im-core/main",["require","im-lib","im-lib/Emitter","bull","./bullConfig"],function(require){function e(module,e,t){module.on(e,function(){var n=Array.prototype.slice.call(arguments);n.unshift(t||e),exports.emit.apply(exports,n)})}var t=require("im-lib"),n=require("im-lib/Emitter"),exports={};return n.mixin(exports),exports.messageHandler=function(e,n){var i=n.adata&&t.json.parse(n.adata)||{},o=i.nickname||e.sinfo.nickname||n.from,r=1e3*n.time;exports.decode(n,function(e){exports.emit("message",e,o,r)})},exports.decode=function(e,t){},exports.init=function(e){var t=require("bull"),n=require("./bullConfig");t.init(n),exports.initCore(e)},exports.initCore=function(t,n,i,o,r){if(i.extend(exports,o),exports.addPlugin(),i.extend(n,r||{}),n.urlRoot&&!/^http/.test(n.urlRoot))n.urlRoot=location.protocol+"//"+n.urlRoot+"/";n.anonym=n.bid?0:1,t.on("message",exports.messageHandler);var a=["error","reconnect","connected","disconnect","offline","csoffline","invitefail","queueing","otherwebimalive","fetchhistorysuccess","fetchhistoryfail","fetchhistoryfinish","visitorblock","autoendtalk","currentIR","showMsgRemind","csonline","transferError","fininshIR","updateNewCSR","visitorTransfer","unknownMsg"];i.each(a,function(n){e(t,n)})},exports.addPlugin=function(){for(var e=0;e<arguments.length;e++)exports.plugin(arguments[e])},exports.connect=function(e,t,n,i,o){function r(t){if(t.invited)t.status=3;switch(t.status){case 0:case 1:e.connect(i,o);break;case 2:e.connect(i,o);break;case 3:if(o.invited||t.invited)t.invited=1,e.connect(i,t);else t.reason="talk to other",e.disconnect(t),e.setStopPick(!1),e.pick();break;case 4:e.connect(i,o);break;default:e.connect(i,o)}}if(n.isLogin())r(t);else n.login(r,function(){exports.emit("error",{type:"init"})},function(){exports.emit("visitorblock")})},exports.auth=function(e,t,n){if(e.isLogin());else e.login(function(){exports.emit("connected")},function(){exports.emit("error",{type:"init"})})},exports.send=function(e,t,n,i){function o(){exports.emit("sendfinish",n),exports.emit("sendsuccess",n)}function r(){exports.emit("sendfail",n)}if(!e.isConnected())return exports.emit("sendfail",n),!1;else return t.encode(n,function(t){t.adata=i,e.send(t,o,r)},r),!0},exports.preSend=function(e,t,n){if(!e.isConnected())return!1;else return void e.preSend({mtype:0,content:n.text})},exports.disconnect=function(e,t,n,i){if(i!==!1)e.disconnect();if(n!==!1)t.logout()},exports.plugin=function(e,t){if(t.encoder)e.addEncoder(t.encoder);if(t.decoder)e.addDecoder(t.decoder);if(t.emit)t.emit=function(){var e=Array.prototype.slice.call(arguments);exports.emit.apply(exports,e)}},exports.get=function(e,t){return e.get(t)},exports}),define("im-core",["im-core/main"],function(e){return e});